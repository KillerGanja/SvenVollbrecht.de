---
import Layout from "../../layouts/Layout.astro";
import type { MarkdownInstance } from "astro";

interface PressFrontmatter {
    title: string;
    url?: string;
    medium?: string;
    date: string;
}

// alle deutschen Press-Artikel laden
const entries = Object.values(
    import.meta.glob<MarkdownInstance<PressFrontmatter>>(
        "../../../content/press/de/*.md",
        {
            eager: true,
        },
    ),
);

// Sortierung: neueste zuerst (nach Datum)
const sortedEntries = entries
    .map((entry) => ({
        ...entry.frontmatter,
    }))
    .sort((a, b) => {
        const dateA = new Date(a.date).getTime();
        const dateB = new Date(b.date).getTime();
        return dateB - dateA;
    });

// Gruppierung nach Jahr
const pressByYear = sortedEntries.reduce(
    (acc, item) => {
        const year = new Date(item.date).getFullYear();
        if (!acc[year]) {
            acc[year] = [];
        }
        acc[year].push(item);
        return acc;
    },
    {} as Record<number, typeof sortedEntries>,
);
---

<Layout title="Presse">
    <h1 class="text-[1.25rem] font-bold text-gray-900 mb-4 lg:mb-6">Presse</h1>

    {
        Object.entries(pressByYear)
            .sort(([yearA], [yearB]) => Number(yearB) - Number(yearA))
            .map(([year, items]) => (
                <div class="mb-12">
                    <h2 class="text-[1.125rem] text-gray-900 mb-2 lg:mb-4">
                        {year}
                    </h2>
                    <ul class="space-y-3">
                        {items.map((item) => (
                            <li class="text-base">
                                {item.url ? (
                                    <a
                                        href={item.url}
                                        target="_blank"
                                        rel="noopener noreferrer"
                                        class="hover:text-gray-600 transition-colors"
                                    >
                                        {item.title}
                                    </a>
                                ) : (
                                    <span>{item.title}</span>
                                )}
                                {item.medium && (
                                    <span class="text-gray-500">
                                        {" "}
                                        â€“ {item.medium}
                                        {item.date &&
                                            `, ${new Date(item.date).toLocaleDateString("de-DE", { month: "2-digit", year: "numeric" })}`}
                                    </span>
                                )}
                            </li>
                        ))}
                    </ul>
                </div>
            ))
    }
</Layout>
