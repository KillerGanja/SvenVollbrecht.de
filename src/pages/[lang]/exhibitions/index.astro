---
import Layout from "../../../layouts/Layout.astro";
import type { MarkdownInstance } from "astro";

export function getStaticPaths() {
    return [{ params: { lang: "de" } }, { params: { lang: "en" } }];
}

const { lang } = Astro.params;

// Load entries
const entries = Object.values(
    import.meta.glob<MarkdownInstance<any>>(
        "../../../content/exhibitions/de/*.md",
        { eager: true },
    ),
);

// Sort and map
const exhibitions = entries
    .map((entry) => ({
        ...entry.frontmatter,
        url:
            lang === "en"
                ? `/en/exhibitions/${entry.frontmatter.slug}/`
                : `/exhibitions/${entry.frontmatter.slug}/`,
    }))
    .sort((a, b) => {
        const orderA = (a as any).order ?? 9999;
        const orderB = (b as any).order ?? 9999;
        if (orderA !== orderB) return orderA - orderB;
        return ((b as any).year ?? 0) - ((a as any).year ?? 0);
    });

const title = lang === "en" ? "Exhibitions" : "Ausstellungen";
---

<Layout title={title}>
    <h1 class="mb-12 text-3xl font-light tracking-wide text-gray-900">
        {title}
    </h1>

    {
        exhibitions.length === 0 ? (
            <p class="text-gray-500">
                {lang === "en"
                    ? "No exhibitions found."
                    : "Noch keine Ausstellungen angelegt."}
            </p>
        ) : (
            <div class="grid grid-cols-1 gap-8 md:grid-cols-2 lg:grid-cols-3">
                {exhibitions.map((exhib) => (
                    <a href={exhib.url} class="group block">
                        <div class="aspect-[4/5] overflow-hidden bg-gray-100 mb-4">
                            {exhib.cover_image ? (
                                <img
                                    src={exhib.cover_image}
                                    alt={exhib.title}
                                    class="h-full w-full object-cover transition-transform duration-500 group-hover:scale-105"
                                />
                            ) : (
                                <div class="flex h-full w-full items-center justify-center text-gray-400">
                                    {lang === "en" ? "No Image" : "Kein Bild"}
                                </div>
                            )}
                        </div>
                        <h2 class="text-lg font-medium text-gray-900 group-hover:text-black">
                            {exhib.title}
                        </h2>
                        <p class="text-sm text-gray-500">
                            {exhib.venue && <span>{exhib.venue}</span>}
                            {exhib.city && <span>, {exhib.city}</span>}
                            {exhib.year && <span> ({exhib.year})</span>}
                        </p>
                    </a>
                ))}
            </div>
        )
    }
</Layout>
