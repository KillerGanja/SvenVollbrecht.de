---
import Layout from "../../../layouts/Layout.astro";
import type { WorkFrontmatter } from "../../../types";

export function getStaticPaths() {
    return [{ params: { lang: "de" } }, { params: { lang: "en" } }];
}

const { lang } = Astro.params;

// Load entries
const worksEntries = await Astro.glob<WorkFrontmatter>(
    "../../../../content/works/de/*.md",
);

// Filter and map
const works = worksEntries
    .map((entry) => ({
        ...entry.frontmatter,
        url:
            lang === "en"
                ? `/en/works/${entry.frontmatter.slug}/`
                : `/works/${entry.frontmatter.slug}/`,
        displayTitle:
            lang === "en" ? entry.frontmatter.title : entry.frontmatter.title,
    }))
    .sort((a, b) => {
        const orderA = a.order ?? 9999;
        const orderB = b.order ?? 9999;
        if (orderA !== orderB) return orderA - orderB;
        return (Number(b.year) || 0) - (Number(a.year) || 0);
    });

const title = lang === "en" ? "Works – Overview" : "Arbeiten – Übersicht";
---

<Layout title={title}>
    <h1 class="mb-12 text-3xl font-light tracking-wide text-gray-900">
        {lang === "en" ? "Works" : "Arbeiten"}
    </h1>

    {
        works.length === 0 ? (
            <p class="text-gray-500">
                {lang === "en"
                    ? "No works found."
                    : "Noch keine Werke angelegt."}
            </p>
        ) : (
            <div class="grid grid-cols-2 gap-4 md:gap-8 md:grid-cols-3 xl:grid-cols-4">
                {works.map((work) => (
                    <a href={work.url} class="group block">
                        <div class="aspect-[4/5] overflow-hidden bg-gray-100">
                            {work.cover_image ? (
                                <img
                                    src={work.cover_image}
                                    alt={work.title}
                                    class="h-full w-full object-cover transition-transform duration-500 group-hover:scale-105"
                                />
                            ) : (
                                <div class="flex h-full w-full items-center justify-center text-gray-400">
                                    {lang === "en" ? "No Image" : "Kein Bild"}
                                </div>
                            )}
                        </div>
                    </a>
                ))}
            </div>
        )
    }
</Layout>
