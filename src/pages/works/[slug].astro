---
import Layout from "../../layouts/Layout.astro";
import WorkSlideshow from "../../components/WorkSlideshow.astro";
import type { MarkdownInstance } from "astro";

import type { WorkFrontmatter } from "../../types";

// 1) Astro anweisen, welche Seiten erzeugt werden sollen
export async function getStaticPaths() {
  const entries = await Astro.glob<WorkFrontmatter>(
    "../../../content/works/de/*.md",
  );

  return entries.map((entry) => {
    return {
      params: { slug: entry.frontmatter.slug },
      props: { entry },
    };
  });
}

interface Props {
  entry: MarkdownInstance<WorkFrontmatter>;
}

// 2) Props entgegennehmen (das einzelne Werk)
const { entry } = Astro.props;
const { frontmatter, Content } = entry;

// Combine cover_image and gallery_images into a single array
const galleryImages = frontmatter.gallery_images || frontmatter.images || [];
const allImages = frontmatter.cover_image
  ? [
      frontmatter.cover_image,
      ...galleryImages.filter((img: string) => img !== frontmatter.cover_image),
    ]
  : galleryImages;
---

<Layout title={frontmatter.title}>
  <div class="mx-auto max-w-4xl">
    {
      allImages && allImages.length > 0 ? (
        <WorkSlideshow images={allImages} title={frontmatter.title} />
      ) : (
        <div class="aspect-[4/5] w-full bg-gray-100 flex items-center justify-center text-gray-400">
          No Images
        </div>
      )
    }

    <div class="mt-8 mb-8 text-center">
      <h1 class="text-2xl font-medium text-gray-900 mb-2">
        {frontmatter.title}
      </h1>
      <div class="text-gray-500 space-y-1">
        {frontmatter.year && <p>{frontmatter.year}</p>}
        {frontmatter.materials && <p>{frontmatter.materials}</p>}
        {frontmatter.dimensions && <p>{frontmatter.dimensions}</p>}
      </div>
    </div>

    <div class="prose prose-gray mx-auto">
      <Content />
    </div>
  </div>
</Layout>
