---
const { images, title } = Astro.props;
---

<link
  rel="stylesheet"
  href="https://unpkg.com/photoswipe@5/dist/photoswipe.css"
/>

<div class="gallery" id="work-gallery">
  {
    images.map((src) => (
      <a href={src} data-pswp-width="1600" data-pswp-height="1200">
        <img src={src} alt={title} loading="lazy" />
      </a>
    ))
  }
</div>

<script type="module">
  import PhotoSwipe from "https://unpkg.com/photoswipe@5/dist/photoswipe.esm.js";

  const gallery = document.getElementById("work-gallery");
  if (gallery) {
    const links = gallery.querySelectorAll("a");

    links.forEach((link) => {
      const img = new Image();
      img.onload = () => {
        link.setAttribute("data-pswp-width", img.naturalWidth);
        link.setAttribute("data-pswp-height", img.naturalHeight);
      };
      img.src = link.href;

      link.addEventListener("click", (e) => {
        e.preventDefault();

        const width = link.getAttribute("data-pswp-width");
        const height = link.getAttribute("data-pswp-height");

        if (!width || !height) return;

        const options = {
          dataSource: [
            {
              src: link.href,
              w: parseInt(width),
              h: parseInt(height),
              alt: link.querySelector("img")?.alt || "",
            },
          ],
          index: 0, // Always start at index 0 since we only have one image
          closeOnVerticalDrag: true,
        };

        const pswp = new PhotoSwipe(options);
        pswp.init();
      });
    });
  }
</script>

<style>
  .gallery {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    margin: 1.5rem 0;
    justify-content: center; /* Center items in the row */
  }

  .gallery a {
    height: 250px; /* Default height */
    flex: 0 0 auto;
    transition: transform 0.2s ease;
  }

  /* Responsive height adjustment */
  @media (min-width: 768px) {
    .gallery a {
      height: 350px;
    }
  }

  @media (max-width: 480px) {
    .gallery a {
      height: 200px;
    }
  }

  .gallery img {
    height: 100%;
    width: auto; /* Width adjusts to maintain aspect ratio */
    object-fit: contain; /* Ensure no cropping */
    border-radius: 6px;
    cursor: zoom-in;
    display: block; /* Remove bottom space */
  }

  .gallery a:hover {
    transform: scale(1.02);
    box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1);
  }
</style>
