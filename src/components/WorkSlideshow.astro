---
interface Props {
    images: string[]; // Keep prop name 'images' for compatibility, but it contains paths to media
    title: string;
}

const { images, title } = Astro.props;

function isVideo(path: string) {
    const videoExtensions = [".mp4", ".webm", ".ogg", ".mov"];
    return videoExtensions.some((ext) => path.toLowerCase().endsWith(ext));
}
---

<style>
    .custom-cursor-left {
        cursor: url("/assets/cursors/arrow-left.png"), w-resize;
    }
    .custom-cursor-right {
        cursor: url("/assets/cursors/arrow-right.png"), e-resize;
    }
</style>

<div class="slideshow relative mx-auto max-w-full">
    <!-- Media Container -->
    <div
        class="relative w-full overflow-hidden bg-white flex items-center justify-center"
    >
        <div id="media-container" class="contents">
            {
                images.map((src, index) =>
                    isVideo(src) ? (
                        <video
                            id={index === 0 ? "current-media" : undefined}
                            src={src}
                            class={`max-h-[80vh] max-w-full object-contain ${index === 0 ? "block" : "hidden"}`}
                            data-index={index}
                            autoplay
                            loop
                            muted
                            playsinline
                            controls
                        />
                    ) : (
                        <img
                            id={index === 0 ? "current-media" : undefined}
                            src={src}
                            alt={title}
                            class={`max-h-[80vh] max-w-full object-contain ${index === 0 ? "block" : "hidden"}`}
                            data-index={index}
                        />
                    ),
                )
            }
        </div>

        <!-- Navigation Overlays -->
        <div
            id="prev-area"
            class="custom-cursor-left absolute left-0 top-0 z-10 h-full w-1/2"
            title="Previous"
        >
        </div>
        <div
            id="next-area"
            class="custom-cursor-right absolute right-0 top-0 z-10 h-full w-1/2"
            title="Next"
        >
        </div>
    </div>
</div>

<script define:vars={{ images }}>
    let currentIndex = 0;
    const mediaContainer = document.getElementById("media-container");
    const prevArea = document.getElementById("prev-area");
    const nextArea = document.getElementById("next-area");

    function updateMedia() {
        if (!mediaContainer) return;

        const mediaElements = mediaContainer.querySelectorAll("[data-index]");

        mediaElements.forEach((el) => {
            if (parseInt(el.dataset.index) === currentIndex) {
                el.classList.remove("hidden");
                el.classList.add("block");
                el.id = "current-media";

                if (el.tagName === "VIDEO") {
                    // Ensure video plays when it becomes visible
                    el.play().catch((e) =>
                        console.log("Autoplay prevented:", e),
                    );
                }
            } else {
                el.classList.add("hidden");
                el.classList.remove("block");
                el.removeAttribute("id");

                if (el.tagName === "VIDEO") {
                    // Pause hidden videos
                    el.pause();
                }
            }
        });
    }

    if (prevArea && nextArea) {
        prevArea.addEventListener("click", () => {
            currentIndex = (currentIndex - 1 + images.length) % images.length;
            updateMedia();
        });

        nextArea.addEventListener("click", () => {
            currentIndex = (currentIndex + 1) % images.length;
            updateMedia();
        });
    }
</script>
